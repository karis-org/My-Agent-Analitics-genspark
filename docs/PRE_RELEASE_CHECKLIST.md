# リリース前チェックリスト

**バージョン**: v6.7.4  
**最終更新日**: 2025年11月8日  
**対象**: 開発者、システム管理者、運営管理者

---

## 目次

1. [リリースフロー](#リリースフロー)
2. [コードチェック](#コードチェック)
3. [機能テスト](#機能テスト)
4. [パフォーマンステスト](#パフォーマンステスト)
5. [セキュリティチェック](#セキュリティチェック)
6. [ドキュメント更新](#ドキュメント更新)
7. [デプロイ前最終確認](#デプロイ前最終確認)
8. [デプロイ後確認](#デプロイ後確認)

---

## リリースフロー

### リリースタイプ

| タイプ | 頻度 | テスト時間 | リスク |
|-------|-----|----------|-------|
| **Major Release** | 年1-2回 | 2週間 | 高 |
| **Minor Release** | 月1-2回 | 1週間 | 中 |
| **Patch Release** | 随時 | 1-2日 | 低 |
| **Hotfix** | 緊急時のみ | 数時間 | 高 |

### リリース判定基準

#### ✅ リリース可能

- 全ての必須テスト合格
- 既知の重大バグなし
- ドキュメント更新完了
- バックアップ取得完了

#### ❌ リリース延期

- クリティカルバグが残存
- パフォーマンス劣化が発生
- セキュリティ脆弱性が未修正
- テストカバレッジ < 70%

---

## コードチェック

### 1. Lintチェック

```bash
cd /home/user/webapp

# TypeScript型チェック
npx tsc --noEmit

# コードフォーマットチェック
npx prettier --check "src/**/*.{ts,tsx}"
```

**合格基準**:
- [ ] エラー 0件
- [ ] 警告 < 5件

---

### 2. ビルドチェック

```bash
npm run build
```

**合格基準**:
- [ ] ビルド成功
- [ ] バンドルサイズ < 1MB
- [ ] ビルド時間 < 2分

**出力例**:
```
✓ 1234 modules transformed.
dist/index.js   709.88 kB
✓ built in 45s
```

---

### 3. 依存関係チェック

```bash
npm audit
```

**合格基準**:
- [ ] Criticalの脆弱性 0件
- [ ] Highの脆弱性 0件
- [ ] Moderate以下のみ許容

**修正方法**:
```bash
npm audit fix
```

---

## 機能テスト

### 1. 認証機能

#### Google OAuth認証

- [ ] **ログイン成功**
  - Google OAuthボタンをクリック
  - Google認証画面が表示される
  - 認証後、ダッシュボードにリダイレクトされる

- [ ] **ログアウト成功**
  - ログアウトアイコンをクリック
  - ログインページにリダイレクトされる

- [ ] **セッション維持**
  - ログイン後、ブラウザを閉じる
  - 再度開いてもログイン状態が保持される

---

### 2. 物件管理機能

#### 物件登録（手動）

- [ ] **新規登録成功**
  - 「新規登録」ボタンをクリック
  - 全項目を入力
  - 「登録」ボタンをクリック
  - 成功メッセージが表示される

- [ ] **バリデーションチェック**
  - 必須項目を空欄にして登録
  - エラーメッセージが表示される

- [ ] **構造タイプ選択**
  - RC造、SRC造、鉄骨造、木造が選択可能

#### OCR機能

- [ ] **PDF読み取り成功**
  - 物件概要書PDFをアップロード
  - 情報が自動抽出される
  - 抽出精度 > 85%

- [ ] **構造タイプ認識**
  - 「鉄筋コンクリート造」→「RC造」に正規化
  - 「鉄骨鉄筋コンクリート造」→「SRC造」に正規化
  - 「鉄骨造」→「鉄骨造」
  - 「木造」→「木造」

- [ ] **異常値検出**
  - 築年数に71400などの異常値が入った場合
  - 黄色の警告ボックスが表示される

---

### 3. 物件分析機能

- [ ] **分析実行成功**
  - 物件詳細ページで「分析を実行」
  - 5秒以内に結果が表示される

- [ ] **指標計算正確性**
  - 表面利回り = (年間収入 ÷ 物件価格) × 100
  - 実質利回り = ((年間収入 - 年間経費) ÷ 物件価格) × 100
  - NOI = 年間収入 - 年間経費
  - DSCR = NOI ÷ 年間返済額
  - LTV = 借入金額 ÷ 物件価格

---

### 4. 統合レポート機能

- [ ] **レポート生成成功**
  - 「統合レポート」タブをクリック
  - 3秒以内にレポートが生成される

- [ ] **Chart.js グラフ表示**
  - 収益用レポート: 3種類のグラフが表示される
    - 収支内訳パイチャート
    - 利回り比較棒グラフ
    - 市場トレンドグラフ
  - 実需用レポート: 2種類のグラフが表示される
    - 家賃分布パイチャート
    - 想定利回り分析棒グラフ

- [ ] **PDF出力**
  - ブラウザの印刷機能で正しく印刷できる
  - レイアウト崩れなし

- [ ] **免責文表示**
  - レポート下部に免責文が表示される

---

### 5. イタンジBB機能

- [ ] **全47都道府県選択可能**
  - 都道府県ドロップダウンに47都道府県が表示される

- [ ] **検索成功**
  - 検索条件を入力
  - 「検索」ボタンをクリック
  - 検索結果が表示される

- [ ] **検索フィールド（拡張版）**
  - 賃料範囲（最小/最大）
  - 築年数範囲（最小/最大）
  - 平米数範囲（最小/最大）
  - 駅徒歩距離
  - 構造タイプ

---

### 6. 管理画面機能（管理者のみ）

- [ ] **ユーザー一覧表示**
  - 全ユーザーが表示される
  - 統計カードが正しく表示される

- [ ] **検索・フィルター**
  - ユーザーID、メール、名前で検索できる
  - 権限フィルターが機能する
  - ステータスフィルターが機能する

- [ ] **CSV出力**
  - CSVボタンをクリック
  - ファイルがダウンロードされる
  - 内容が正しい

- [ ] **ドキュメントセンター**
  - ドキュメントセンターボタンをクリック
  - ドキュメント一覧が表示される
  - 各ドキュメントが正しく表示される

---

## パフォーマンステスト

### 1. レスポンス時間

```bash
# ホームページ
curl -w "%{time_total}\n" -o /dev/null -s https://my-agent-analytics.pages.dev
# 目標: < 500ms

# ダッシュボード
curl -w "%{time_total}\n" -o /dev/null -s https://my-agent-analytics.pages.dev/dashboard
# 目標: < 1s

# API（物件一覧）
curl -w "%{time_total}\n" -o /dev/null -s https://my-agent-analytics.pages.dev/api/properties
# 目標: < 500ms
```

**合格基準**:
- [ ] ホームページ < 500ms
- [ ] ダッシュボード < 1s
- [ ] API < 500ms

---

### 2. 負荷テスト（オプション）

```bash
# Apache Benchを使用
ab -n 1000 -c 10 https://my-agent-analytics.pages.dev/

# 期待値:
# - 成功率: 100%
# - 平均レスポンス時間: < 500ms
# - エラー: 0件
```

---

### 3. バンドルサイズ

```bash
npm run build
ls -lh dist/
```

**合格基準**:
- [ ] 合計サイズ < 1MB
- [ ] JavaScript < 800KB
- [ ] CSS < 100KB

---

## セキュリティチェック

### 1. 脆弱性スキャン

```bash
npm audit
```

**合格基準**:
- [ ] Critical: 0件
- [ ] High: 0件

---

### 2. 環境変数確認

```bash
npx wrangler pages deployment list --project-name my-agent-analytics
```

**確認項目**:
- [ ] OPENAI_API_KEY: 設定済み
- [ ] GOOGLE_CLIENT_ID: 設定済み
- [ ] GOOGLE_CLIENT_SECRET: 設定済み
- [ ] SESSION_SECRET: 設定済み
- [ ] ITANDI_EMAIL: 設定済み
- [ ] ITANDI_PASSWORD: 設定済み

---

### 3. 認証・認可

- [ ] **未認証アクセス防止**
  - ログインせずに `/dashboard` にアクセス
  - ログインページにリダイレクトされる

- [ ] **権限チェック**
  - 一般ユーザーで `/admin` にアクセス
  - 403 Forbiddenエラーが表示される

---

## ドキュメント更新

### 1. README.md

- [ ] **バージョン番号更新**
- [ ] **最新のデプロイURL更新**
- [ ] **新機能の説明追加**
- [ ] **既知の問題更新**

---

### 2. ユーザーマニュアル

- [ ] **新機能の使い方を追加**
- [ ] **スクリーンショット更新**
- [ ] **トラブルシューティング追加**

---

### 3. システム仕様書

- [ ] **API仕様更新**
- [ ] **データベーススキーマ更新**
- [ ] **技術スタック更新**

---

## デプロイ前最終確認

### 1. バックアップ

```bash
# D1データベースのバックアップ
npx wrangler d1 execute webapp-production \
  --command=".dump" \
  --remote > backup_pre_release_$(date +%Y%m%d).sql

gzip backup_pre_release_$(date +%Y%m%d).sql
```

**合格基準**:
- [ ] バックアップファイル作成成功
- [ ] ファイルサイズ確認

---

### 2. Migration確認

```bash
# 未適用Migrationがないか確認
npx wrangler d1 migrations list webapp-production
```

**合格基準**:
- [ ] 未適用Migrationがない、または
- [ ] 未適用Migrationを適用済み

---

### 3. Git状態確認

```bash
git status
git log --oneline -5
```

**合格基準**:
- [ ] 全ての変更がコミット済み
- [ ] GitHubにプッシュ済み

---

## デプロイ後確認

### 1. 本番環境動作確認

```bash
# ヘルスチェック
curl -I https://my-agent-analytics.pages.dev
# 期待値: HTTP 200 OK

# 主要ページ確認
curl -I https://my-agent-analytics.pages.dev/dashboard
curl -I https://my-agent-analytics.pages.dev/properties
curl -I https://my-agent-analytics.pages.dev/admin
```

**合格基準**:
- [ ] 全てのページで HTTP 200 または 302（認証リダイレクト）

---

### 2. 機能動作確認（実際の操作）

- [ ] **ログイン**
- [ ] **物件登録**
- [ ] **OCR機能**
- [ ] **統合レポート**
- [ ] **イタンジBB検索**
- [ ] **管理画面（管理者）**

---

### 3. エラーログ確認

```bash
npx wrangler pages deployment tail --project-name my-agent-analytics
```

**合格基準**:
- [ ] エラーログ 0件（5分間）

---

### 4. パフォーマンス確認

```bash
curl -w "%{time_total}\n" -o /dev/null -s https://my-agent-analytics.pages.dev
```

**合格基準**:
- [ ] レスポンス時間 < 500ms

---

## リリースノート作成

### テンプレート

```markdown
# リリースノート v6.7.4

**リリース日**: 2025年11月8日

## 新機能

- イタンジBB: 全47都道府県対応
- OCR: 構造タイプ認識精度向上
- 管理画面: ドキュメントセンター実装

## 改善

- パフォーマンス: ページ読み込み速度20%向上
- UI/UX: モバイル対応強化

## バグ修正

- 統合レポート: フィールド不一致修正
- OCR: 築年数異常値検出機能追加

## 既知の問題

- なし

## アップグレード手順

1. Migration 0011を適用
2. 環境変数を確認
3. デプロイ

## 互換性

- 破壊的変更: なし
- データベーススキーマ変更: あり（Migration 0011）
```

---

## お問い合わせ

### サポート

- **メール**: maa-unnei@support

---

## 更新履歴

### v6.7.4 (2025-11-08)
- ドキュメント初版作成

---

**このチェックリストは継続的に更新されます。**
