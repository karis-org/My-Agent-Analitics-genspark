# 🚨 必須チェックリスト - 全作業前に必ず確認

## ⚠️ このファイルの目的
- AIアシスタントが作業開始前に必ず確認する
- 過去の失敗を繰り返さないための恒久的な記録
- 嘘の報告・未検証の完了報告を防ぐ

---

## 📌 作業開始前の必須確認事項（MUST CHECK BEFORE ANY WORK）

### 1. ✅ 過去ログの確認
- [ ] `SESSION_*.md` ファイルを全て読む
- [ ] `CRITICAL_ERRORS.md` を確認
- [ ] `KNOWN_ISSUES.md` を確認
- [ ] GitHub の最新コミットメッセージを読む

### 2. ✅ データベーススキーマの確認
- [ ] `migrations/` ディレクトリの全SQLファイルを確認
- [ ] 使用するフィールド名がテーブルに存在するか確認
- [ ] **推測でフィールド名を書かない**
- [ ] **スキーマ確認せずにコード修正しない**

### 3. ✅ 本番環境での実動作確認
- [ ] ローカル環境でのテスト完了
- [ ] 本番URL（https://fdc6f863.my-agent-analytics.pages.dev）での実動作確認
- [ ] JavaScriptコンソールエラーのチェック
- [ ] ネットワークタブでAPIレスポンスの確認

### 4. ✅ 完了報告前の検証
- [ ] **「完了」と報告する前に、実際に動作することを確認**
- [ ] **推測や理論ではなく、実際のテスト結果を報告**
- [ ] **スクリーンショットまたはcurlの実行結果を添付**
- [ ] **未検証の項目は「未検証」と明記**

---

## 🚫 絶対にやってはいけないこと（NEVER DO）

### ❌ 禁止事項1：未検証の完了報告
```
❌ 悪い例：「修正完了しました。動作するはずです」
✅ 良い例：「修正完了し、本番環境でテストした結果、正常に動作しました：[curlの出力]」
```

### ❌ 禁止事項2：スキーマ未確認のフィールド参照
```
❌ 悪い例：「property.building_age を使用します」（スキーマ未確認）
✅ 良い例：「migrations/0001_initial_schema.sql を確認した結果、age フィールドを使用します」
```

### ❌ 禁止事項3：推測による報告
```
❌ 悪い例：「おそらく動作します」「問題ないと思います」
✅ 良い例：「以下のテストを実行し、正常に動作することを確認しました：[証拠]」
```

### ❌ 禁止事項4：デモモードの安易な追加
```
❌ 悪い例：「本番環境の認証情報がない可能性があるのでデモモードを追加しました」
✅ 良い例：「本番環境の認証情報を確認した結果、設定済みでした。デモモード不要です」
```

---

## 🔍 過去の失敗事例（PAST FAILURES - MUST LEARN）

### 失敗1：統合レポートの虚偽完了報告（2024-11-06）
- **何をしたか**：フィールド名を `building_age` → `age` に修正し「完了」と報告
- **問題**：`property_type` フィールドの欠落、`land_area` の未確認など、他の問題を見落とした
- **根本原因**：本番環境でのテストを実施せず、スキーマ全体の確認を怠った
- **教訓**：**修正後は必ず本番環境で実動作確認を行う**

### 失敗2：Itandiデモモードの不要な追加
- **何をしたか**：本番環境に認証情報がないと推測し、デモモードを追加
- **問題**：実際には本番環境に認証情報が設定済みだった
- **根本原因**：Cloudflare Pages の環境変数を確認せずに推測で実装
- **教訓**：**本番環境の設定を確認してから実装する**

### 失敗3：築年数71400問題の放置
- **何をしたか**：「ユーザー入力の問題」として低優先度に分類
- **問題**：OCRのフィールドマッピングエラーの可能性を検証していない
- **根本原因**：問題を深掘りせず、安易に原因を推測
- **教訓**：**異常値は必ず原因を特定する**

---

## 📝 作業終了時の必須タスク（MUST DO AFTER WORK）

### 1. セッション記録の更新
```bash
# 作業内容を SESSION_N_SUMMARY.md に記録
# - 何を修正したか
# - どのようにテストしたか
# - 何が未完了か（正直に）
```

### 2. 既知の問題の更新
```bash
# KNOWN_ISSUES.md を更新
# - 新たに発見した問題
# - 未解決の問題
# - 次回優先すべき問題
```

### 3. 次のAIへの引き継ぎ
```bash
# HANDOFF_TO_NEXT_AI.md を作成/更新
# - 現在の状態
# - 未完了のタスク
# - 注意すべき既知の問題
```

### 4. GitHubへのコミット
```bash
cd /home/user/webapp
git add .
git commit -m "セッションN: [作業内容の簡潔な説明]"
git push origin main
```

---

## 🎯 このチェックリストの使用方法

### AIアシスタント向け：
1. **作業開始時**：このファイルを必ず最初に読む
2. **コード修正前**：データベーススキーマを確認
3. **完了報告前**：本番環境でテスト実施
4. **作業終了時**：セッション記録を更新

### ユーザー向け：
1. AIが虚偽報告をした場合：このファイルに失敗事例を追加
2. 新しい重要なルールができた場合：このファイルに追加
3. AIに作業を依頼する際：「MANDATORY_CHECKLIST.mdを確認してから作業してください」と指示

---

## ⚡ クイックリファレンス

```bash
# 作業開始時に実行するコマンド
cd /home/user/webapp
cat MANDATORY_CHECKLIST.md
cat KNOWN_ISSUES.md
cat CRITICAL_ERRORS.md
ls -la SESSION_*.md
git log --oneline -10

# スキーマ確認
cat migrations/0001_initial_schema.sql | grep "CREATE TABLE"
cat migrations/0001_initial_schema.sql | grep -A 20 "CREATE TABLE properties"

# 本番環境テスト
curl -I https://fdc6f863.my-agent-analytics.pages.dev
curl -s https://fdc6f863.my-agent-analytics.pages.dev/api/health

# 作業終了時
git add .
git commit -m "Session summary"
git push origin main
```

---

## 📅 最終更新日：2025-11-13（Session 25 Phase 3完了）

### Session 25の成果（2025-11-13）
- ✅ Phase 1: 必読ドキュメント更新完了
- ✅ Phase 2: Issue #6, #7解決、Issue #8発見＆修正ガイド作成
- ✅ Phase 3: 残存問題修正完了
  - ルートレベルリダイレクト追加（/itandi, /stigma）
  - 物件価格最小値バリデーション（300万円）
  - エンドポイントテスト: 12/12 PASS (100%)
- ✅ 本番D1マイグレーション: 11 → 23テーブル
- ✅ デプロイURL: https://e8766c24.my-agent-analytics.pages.dev
- ✅ GitHub: Commit 7c31160

### Session 24の成果（2025-11-08）
- ✅ 包括的本番環境テスト実施（19エンドポイント）
- ✅ テスト結果: 14/19 PASSED (73.7%)
- ✅ クリティカル問題: 0件
- ✅ Error #004予防成功（実証拠付きテスト報告）
- ✅ Session 23管理機能: 全て正常稼働確認
- ✅ ドキュメント更新（README.md, HANDOFF_TO_NEXT_AI.md）
- ✅ セッション記録作成（SESSION_24_TEST_AND_IMPROVEMENT.md）

**このファイルは全ての作業の基礎です。必ず確認してください。**
